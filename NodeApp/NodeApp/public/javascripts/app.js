var app = angular.module('angularjsNodejsTutorial', []);

app.controller('loginController', function($scope, $http) {
  $scope.verifyLogin = function() {
    // To check in the console if the variables are correctly storing the input:
    // console.log($scope.username, $scope.password);

    var request = $http({
      url: '/login',
      method: "POST",
      data: {
        'username': $scope.username,
        'password': $scope.password
      }
    })
    
    request.success(function(response) {
      // success
      console.log(response);
      if (response.result === "success") {
		alert("Welcome");
        // After you've written the INSERT query in routes/index.js, uncomment the following line
        window.location.href = "http://localhost:8081/dashboard";
      }
	  else if(response.result === "fail"){
		  alert("Wrong usrname or password");
	  }
    });
    
    request.error(function(err) {
      // failed
	  
      console.log("error: ", err);
	  
    });

  };
});

app.controller('registerController', function($scope, $http) {
  $scope.verifyRegister = function() {
    // To check in the console if the variables are correctly storing the input:
    // console.log($scope.username, $scope.password);

    var request = $http({
      url: '/register',
      method: "POST",
      data: {
        'username': $scope.username,
        'password': $scope.password,
		    'state':  $scope.state
      }
    })
    
    request.success(function(response) {
      // success
      console.log(response);
      if (response.result == "success") {
        // After you've written the INSERT query in routes/index.js, uncomment the following line
		alert("register succssfully!");
        window.location.href = "http://localhost:8081/";
      }
	  else if(response.result === "fail"){
		  alert("fail to register, please try again");
	  }
    });
    
    request.error(function(err) {
      // failed
	  
      console.log("error: ", err);
    });

  };
});

//dashboard controller 
app.controller('userController', function($scope, $http) {    
  $scope.getInfo = function(){
    var selections = document.getElementById('selected_state');
    var city = document.getElementById("inputCity").value;
    var state = selections.options[selections.selectedIndex].text;
    var bor = document.getElementById("buy_or_rent").value;
  var lv_buy=[{"RegionName":"89135","RecentPrice":"245.38","population":24144,"avgstar":"3.90","ptr":"17.68","avg2014":174.49365234375,"avg2015":183.736083984375,"avg2016":197.75875854492188,"avg2017":222.82423400878906,"avg2018":242.14990234375,"tavg2014":15.389166831970215,"tavg2015":15.757499694824219,"tavg2016":15.995833396911621,"tavg2017":16.606666564941406,"tavg2018":17.684165954589844},{"RegionName":"89134","RecentPrice":"212.20","population":24040,"avgstar":"4.01","ptr":"17.36","avg2014":150.68836975097656,"avg2015":157.81321716308594,"avg2016":171.29156494140625,"avg2017":184.89529418945312,"avg2018":206.14476013183594,"tavg2014":15.015000343322754,"tavg2015":15.144166946411133,"tavg2016":15.337499618530273,"tavg2017":16.289167404174805,"tavg2018":17.328332901000977},{"RegionName":"89144","RecentPrice":"209.29","population":18714,"avgstar":"3.79","ptr":"17.26","avg2014":148.64434814453125,"avg2015":156.99546813964844,"avg2016":164.1343231201172,"avg2017":178.98597717285156,"avg2018":199.15237426757812,"tavg2014":14.938333511352539,"tavg2015":15.279166221618652,"tavg2016":15.463333129882812,"tavg2017":16.149999618530273,"tavg2018":17.29083251953125},{"RegionName":"89123","RecentPrice":"183.51","population":56300,"avgstar":"3.72","ptr":"16.86","avg2014":121.33885192871094,"avg2015":132.932373046875,"avg2016":140.33204650878906,"avg2017":155.2801513671875,"avg2018":176.99093627929688,"tavg2014":13.449166297912598,"tavg2015":14.079166412353516,"tavg2016":14.804166793823242,"tavg2017":15.677499771118164,"tavg2018":16.815000534057617},{"RegionName":"89113","RecentPrice":"179.51","population":23800,"avgstar":"3.79","ptr":"16.81","avg2014":123.44061279296875,"avg2015":133.04171752929688,"avg2016":141.68197631835938,"avg2017":152.99490356445312,"avg2018":175.66839599609375,"tavg2014":13.394166946411133,"tavg2015":14.056666374206543,"tavg2016":14.410833358764648,"tavg2017":15.546667098999023,"tavg2018":16.655834197998047},{"RegionName":"89117","RecentPrice":"176.12","population":55416,"avgstar":"3.86","ptr":"17.04","avg2014":124.69673156738281,"avg2015":134.10244750976562,"avg2016":145.07606506347656,"avg2017":156.27471923828125,"avg2018":170.45831298828125,"tavg2014":14.43416690826416,"tavg2015":14.801666259765625,"tavg2016":15.316666603088379,"tavg2017":16.165000915527344,"tavg2018":17.1825008392334},{"RegionName":"89103","RecentPrice":"175.43","population":50519,"avgstar":"3.67","ptr":"12.51","avg2014":101.72382354736328,"avg2015":121.6654281616211,"avg2016":133.371826171875,"avg2017":150.42369079589844,"avg2018":167.44711303710938,"tavg2014":9.920000076293945,"tavg2015":10.119166374206543,"tavg2016":9.907500267028809,"tavg2017":11.045833587646484,"tavg2018":12.760833740234375},{"RegionName":"89102","RecentPrice":"170.95","population":35759,"avgstar":"3.60","ptr":"13.97","avg2014":100.55974578857422,"avg2015":111.3531265258789,"avg2016":127.88829040527344,"avg2017":149.27626037597656,"avg2018":167.6388397216797,"tavg2014":10.550833702087402,"tavg2015":11.186666488647461,"tavg2016":11.505000114440918,"tavg2017":12.632499694824219,"tavg2018":13.979166984558105},{"RegionName":"89183","RecentPrice":"169.99","population":36005,"avgstar":"3.64","ptr":"16.48","avg2014":110.21611022949219,"avg2015":119.59569549560547,"avg2016":128.84652709960938,"avg2017":144.94985961914062,"avg2018":166.33335876464844,"tavg2014":12.641666412353516,"tavg2015":13.223333358764648,"tavg2016":14.15916633605957,"tavg2017":15.269166946411133,"tavg2018":16.49416732788086},{"RegionName":"89141","RecentPrice":"169.59","population":25150,"avgstar":"3.98","ptr":"17.32","avg2014":123.08922576904297,"avg2015":130.08767700195312,"avg2016":138.2583465576172,"avg2017":151.22586059570312,"avg2018":165.60353088378906,"tavg2014":14.404999732971191,"tavg2015":14.875,"tavg2016":15.268333435058594,"tavg2017":16.0625,"tavg2018":17.213333129882812},{"RegionName":"89147","RecentPrice":"167.23","population":49778,"avgstar":"3.96","ptr":"16.62","avg2014":113.39905548095703,"avg2015":122.72936248779297,"avg2016":132.08950805664062,"avg2017":143.80982971191406,"avg2018":167.11517333984375,"tavg2014":12.892499923706055,"tavg2015":13.625,"tavg2016":14.35083293914795,"tavg2017":15.399999618530273,"tavg2018":16.69416618347168},{"RegionName":"89148","RecentPrice":"166.20","population":39712,"avgstar":"3.86","ptr":"17.30","avg2014":118.47107696533203,"avg2015":128.53330993652344,"avg2016":134.68321228027344,"avg2017":148.38330078125,"avg2018":164.3004150390625,"tavg2014":14.169166564941406,"tavg2015":14.725000381469727,"tavg2016":15.068333625793457,"tavg2017":16.04083251953125,"tavg2018":17.20916748046875},{"RegionName":"89118","RecentPrice":"165.04","population":19318,"avgstar":"3.91","ptr":"14.57","avg2014":102.27901458740234,"avg2015":116.4738540649414,"avg2016":132.6145477294922,"avg2017":142.9355926513672,"avg2018":160.87118530273438,"tavg2014":10.713333129882812,"tavg2015":11.481666564941406,"tavg2016":12.207500457763672,"tavg2017":12.960000038146973,"tavg2018":14.300833702087402},{"RegionName":"89149","RecentPrice":"164.93","population":31143,"avgstar":"3.61","ptr":"16.55","avg2014":108.56626892089844,"avg2015":119.6715316772461,"avg2016":129.6776885986328,"avg2017":141.94805908203125,"avg2018":161.76071166992188,"tavg2014":13.401666641235352,"tavg2015":13.885833740234375,"tavg2016":14.338333129882812,"tavg2017":15.416666984558105,"tavg2018":16.559999465942383},{"RegionName":"89139","RecentPrice":"164.42","population":30477,"avgstar":"3.79","ptr":"17.12","avg2014":113.64399719238281,"avg2015":118.94221496582031,"avg2016":126.49800872802734,"avg2017":137.85594177246094,"avg2018":159.53286743164062,"tavg2014":13.914166450500488,"tavg2015":14.50333309173584,"tavg2016":14.845833778381348,"tavg2017":15.789999961853027,"tavg2018":16.947500228881836},{"RegionName":"89129","RecentPrice":"163.19","population":51252,"avgstar":"3.76","ptr":"16.62","avg2014":108.57286071777344,"avg2015":115.21814727783203,"avg2016":122.97929382324219,"avg2017":138.32896423339844,"avg2018":158.8462677001953,"tavg2014":13.255833625793457,"tavg2015":13.838333129882812,"tavg2016":14.385833740234375,"tavg2017":15.40583324432373,"tavg2018":16.665000915527344},{"RegionName":"89128","RecentPrice":"162.89","population":35669,"avgstar":"3.66","ptr":"16.03","avg2014":100.57342529296875,"avg2015":110.84500122070312,"avg2016":122.84199523925781,"avg2017":138.56187438964844,"avg2018":159.023193359375,"tavg2014":12.262499809265137,"tavg2015":12.635833740234375,"tavg2016":13.0600004196167,"tavg2017":14.322500228881836,"tavg2018":15.96166706085205},{"RegionName":"89178","RecentPrice":"162.58","population":27588,"avgstar":"4.11","ptr":"17.17","avg2014":113.1169204711914,"avg2015":120.74414825439453,"avg2016":128.4620819091797,"avg2017":138.99781799316406,"avg2018":158.264892578125,"tavg2014":14.180832862854004,"tavg2015":14.701666831970215,"tavg2016":15.132499694824219,"tavg2017":15.967499732971191,"tavg2018":17.104999542236328},{"RegionName":"89146","RecentPrice":"162.17","population":19071,"avgstar":"3.81","ptr":"15.51","avg2014":101.6963882446289,"avg2015":112.10435485839844,"avg2016":121.36235809326172,"avg2017":137.16229248046875,"avg2018":157.87969970703125,"tavg2014":11.015000343322754,"tavg2015":11.665833473205566,"tavg2016":12.294166564941406,"tavg2017":13.72249984741211,"tavg2018":15.46833324432373},{"RegionName":"89130","RecentPrice":"161.65","population":33015,"avgstar":"3.70","ptr":"16.52","avg2014":104.96153259277344,"avg2015":112.94775390625,"avg2016":123.7175064086914,"avg2017":140.10145568847656,"avg2018":158.4467315673828,"tavg2014":12.932499885559082,"tavg2015":13.587499618530273,"tavg2016":14.164166450500488,"tavg2017":15.269166946411133,"tavg2018":16.52750015258789},{"RegionName":"89131","RecentPrice":"160.32","population":43072,"avgstar":"3.69","ptr":"17.08","avg2014":111.70643615722656,"avg2015":120.32872772216797,"avg2016":126.91815948486328,"avg2017":140.9774932861328,"avg2018":157.1781768798828,"tavg2014":14.245833396911621,"tavg2015":14.78833293914795,"tavg2016":15.051666259765625,"tavg2017":16.054166793823242,"tavg2018":17.116666793823242},{"RegionName":"89145","RecentPrice":"160.30","population":23186,"avgstar":"3.75","ptr":"16.04","avg2014":104.12995147705078,"avg2015":116.7367935180664,"avg2016":126.6026611328125,"avg2017":145.04754638671875,"avg2018":164.55445861816406,"tavg2014":11.425000190734863,"tavg2015":12.079166412353516,"tavg2016":12.83666706085205,"tavg2017":14.165833473205566,"tavg2018":15.732500076293945},{"RegionName":"89104","RecentPrice":"159.22","population":39909,"avgstar":"3.63","ptr":"13.35","avg2014":82.2761001586914,"avg2015":92.28689575195312,"avg2016":104.92854309082031,"avg2017":124.88953399658203,"avg2018":152.35086059570312,"tavg2014":9.59333324432373,"tavg2015":10.213333129882812,"tavg2016":11.010000228881836,"tavg2017":12.208333015441895,"tavg2018":13.657500267028809},{"RegionName":"89166","RecentPrice":"158.52","population":13209,"avgstar":"4.17","ptr":"16.52","avg2014":110.10304260253906,"avg2015":115.38002014160156,"avg2016":123.46358489990234,"avg2017":136.1494140625,"avg2018":151.16656494140625,"tavg2014":13.525833129882812,"tavg2015":13.765832901000977,"tavg2016":14.460833549499512,"tavg2017":15.431666374206543,"tavg2018":16.532499313354492},{"RegionName":"89108","RecentPrice":"156.25","population":70123,"avgstar":"3.39","ptr":"15.26","avg2014":86.25341796875,"avg2015":96.27239227294922,"avg2016":106.67691802978516,"avg2017":125.28691864013672,"avg2018":150.81011962890625,"tavg2014":10.59083366394043,"tavg2015":11.249166488647461,"tavg2016":12.044166564941406,"tavg2017":13.007499694824219,"tavg2018":14.729999542236328},{"RegionName":"89107","RecentPrice":"153.23","population":36282,"avgstar":"3.43","ptr":"12.71","avg2014":80.80437469482422,"avg2015":91.72968292236328,"avg2016":100.67711639404297,"avg2017":124.4217529296875,"avg2018":146.25099182128906,"tavg2014":9.669166564941406,"tavg2015":9.998332977294922,"tavg2016":10.327500343322754,"tavg2017":11.28416633605957,"tavg2018":12.774999618530273},{"RegionName":"89122","RecentPrice":"152.74","population":45720,"avgstar":"3.29","ptr":"14.84","avg2014":91.7537612915039,"avg2015":100.58373260498047,"avg2016":110.0865478515625,"avg2017":123.77702331542969,"avg2018":145.69635009765625,"tavg2014":10.758333206176758,"tavg2015":11.55916690826416,"tavg2016":12.10083293914795,"tavg2017":12.842499732971191,"tavg2018":14.400833129882812},{"RegionName":"89142","RecentPrice":"150.70","population":33731,"avgstar":"3.76","ptr":"15.19","avg2014":86.49108123779297,"avg2015":98.35992431640625,"avg2016":107.56929779052734,"avg2017":123.96784973144531,"avg2018":143.52703857421875,"tavg2014":10.5649995803833,"tavg2015":11.483333587646484,"tavg2016":12.213333129882812,"tavg2017":13.183333396911621,"tavg2018":14.779999732971191},{"RegionName":"89120","RecentPrice":"148.51","population":23311,"avgstar":"3.82","ptr":"16.12","avg2014":91.85260009765625,"avg2015":104.19746398925781,"avg2016":113.90432739257812,"avg2017":129.4482879638672,"avg2018":149.33349609375,"tavg2014":11.404999732971191,"tavg2015":12.249166488647461,"tavg2016":13.387499809265137,"tavg2017":14.657500267028809,"tavg2018":16.030000686645508},{"RegionName":"89110","RecentPrice":"147.00","population":70994,"avgstar":"3.47","ptr":"14.99","avg2014":80.31043243408203,"avg2015":92.84278106689453,"avg2016":104.44084930419922,"avg2017":116.51382446289062,"avg2018":140.6477508544922,"tavg2014":10.060832977294922,"tavg2015":11.048333168029785,"tavg2016":11.864166259765625,"tavg2017":12.678333282470703,"tavg2018":14.397500038146973},{"RegionName":"89156","RecentPrice":"145.60","population":27794,"avgstar":"3.04","ptr":"15.16","avg2014":85.9326400756836,"avg2015":94.17044830322266,"avg2016":103.63224792480469,"avg2017":119.41726684570312,"avg2018":139.73863220214844,"tavg2014":10.507499694824219,"tavg2015":11.357500076293945,"tavg2016":12.296667098999023,"tavg2017":13.040833473205566,"tavg2018":14.561666488647461},{"RegionName":"89121","RecentPrice":"141.71","population":64096,"avgstar":"3.47","ptr":"14.38","avg2014":78.62831115722656,"avg2015":88.38558197021484,"avg2016":99.04265594482422,"avg2017":113.89730834960938,"avg2018":134.03024291992188,"tavg2014":9.973333358764648,"tavg2015":10.69083309173584,"tavg2016":11.46916675567627,"tavg2017":12.691666603088379,"tavg2018":14.172499656677246},{"RegionName":"89169","RecentPrice":"138.00","population":23304,"avgstar":"3.32","ptr":"11.32","avg2014":96.43269348144531,"avg2015":101.41755676269531,"avg2016":110.31622314453125,"avg2017":120.91866302490234,"avg2018":141.5447540283203,"tavg2014":9.136666297912598,"tavg2015":9.512499809265137,"tavg2016":9.330833435058594,"tavg2017":9.853333473205566,"tavg2018":11.239166259765625}];
  var lv_rent=[{"RegionName":"89169","RecentPrice":"1.72","population":23304,"avgstar":"3.33","ptr":"11.32","avg2014":1.6083205938339233,"avg2015":1.5468566417694092,"avg2016":1.6335469484329224,"avg2017":1.6176891326904297,"avg2018":1.6351896524429321,"tavg2014":9.136666297912598,"tavg2015":9.512499809265137,"tavg2016":9.330833435058594,"tavg2017":9.853333473205566,"tavg2018":11.239166259765625},{"RegionName":"89109","RecentPrice":"1.54","population":7770,"avgstar":"3.63","ptr":"12.48","avg2014":1.5097460746765137,"avg2015":1.4984248876571655,"avg2016":1.5436429977416992,"avg2017":1.513492226600647,"avg2018":1.5682491064071655,"tavg2014":13.595000267028809,"tavg2015":14.295833587646484,"tavg2016":11.875833511352539,"tavg2017":12.823333740234375,"tavg2018":13.925000190734863},{"RegionName":"89103","RecentPrice":"1.21","population":50519,"avgstar":"3.67","ptr":"12.51","avg2014":0.8503755927085876,"avg2015":0.9233481287956238,"avg2016":0.9588871002197266,"avg2017":1.0820794105529785,"avg2018":1.1647777557373047,"tavg2014":9.920000076293945,"tavg2015":10.119166374206543,"tavg2016":9.907500267028809,"tavg2017":11.045833587646484,"tavg2018":12.760833740234375},{"RegionName":"89113","RecentPrice":"1.07","population":23800,"avgstar":"3.81","ptr":"16.81","avg2014":0.7967632412910461,"avg2015":0.8045395016670227,"avg2016":0.8425643444061279,"avg2017":0.8975192904472351,"avg2018":1.006705403327942,"tavg2014":13.394166946411133,"tavg2015":14.056666374206543,"tavg2016":14.410833358764648,"tavg2017":15.546667098999023,"tavg2018":16.655834197998047},{"RegionName":"89123","RecentPrice":"1.06","population":56300,"avgstar":"3.72","ptr":"16.86","avg2014":0.8215013146400452,"avg2015":0.854698657989502,"avg2016":0.8853554725646973,"avg2017":0.9568476676940918,"avg2018":1.0249707698822021,"tavg2014":13.449166297912598,"tavg2015":14.079166412353516,"tavg2016":14.804166793823242,"tavg2017":15.677499771118164,"tavg2018":16.815000534057617},{"RegionName":"89134","RecentPrice":"1.04","population":24040,"avgstar":"4.02","ptr":"17.36","avg2014":0.8119620680809021,"avg2015":0.8531567454338074,"avg2016":0.8967577219009399,"avg2017":0.9469965696334839,"avg2018":1.0061496496200562,"tavg2014":15.015000343322754,"tavg2015":15.144166946411133,"tavg2016":15.337499618530273,"tavg2017":16.289167404174805,"tavg2018":17.328332901000977},{"RegionName":"89144","RecentPrice":"1.04","population":18714,"avgstar":"3.81","ptr":"17.26","avg2014":0.8475954532623291,"avg2015":0.8796624541282654,"avg2016":0.9048879146575928,"avg2017":0.9544352293014526,"avg2018":1.029609203338623,"tavg2014":14.938333511352539,"tavg2015":15.279166221618652,"tavg2016":15.463333129882812,"tavg2017":16.149999618530273,"tavg2018":17.29083251953125},{"RegionName":"89118","RecentPrice":"1.04","population":19318,"avgstar":"3.92","ptr":"14.57","avg2014":0.7842627167701721,"avg2015":0.8250160217285156,"avg2016":0.8759748935699463,"avg2017":0.9775651693344116,"avg2018":0.9991613030433655,"tavg2014":10.713333129882812,"tavg2015":11.481666564941406,"tavg2016":12.207500457763672,"tavg2017":12.960000038146973,"tavg2018":14.300833702087402},{"RegionName":"89135","RecentPrice":"1.00","population":24144,"avgstar":"3.86","ptr":"17.68","avg2014":0.8386094570159912,"avg2015":0.8707769513130188,"avg2016":0.8993099331855774,"avg2017":0.9339646100997925,"avg2018":0.9896814227104187,"tavg2014":15.389166831970215,"tavg2015":15.757499694824219,"tavg2016":15.995833396911621,"tavg2017":16.606666564941406,"tavg2018":17.684165954589844},{"RegionName":"89117","RecentPrice":"0.99","population":55416,"avgstar":"3.84","ptr":"17.04","avg2014":0.7489374876022339,"avg2015":0.7857064604759216,"avg2016":0.8207190632820129,"avg2017":0.873504102230072,"avg2018":0.9569958448410034,"tavg2014":14.43416690826416,"tavg2015":14.801666259765625,"tavg2016":15.316666603088379,"tavg2017":16.165000915527344,"tavg2018":17.1825008392334},{"RegionName":"89145","RecentPrice":"0.99","population":23186,"avgstar":"3.76","ptr":"16.04","avg2014":0.7637144923210144,"avg2015":0.792255699634552,"avg2016":0.8254902958869934,"avg2017":0.9088305830955505,"avg2018":0.9407517313957214,"tavg2014":11.425000190734863,"tavg2015":12.079166412353516,"tavg2016":12.83666706085205,"tavg2017":14.165833473205566,"tavg2018":15.732500076293945},{"RegionName":"89107","RecentPrice":"0.98","population":36282,"avgstar":"3.44","ptr":"12.71","avg2014":0.6994535326957703,"avg2015":0.7239341139793396,"avg2016":0.769247829914093,"avg2017":0.8319344520568848,"avg2018":0.9421302080154419,"tavg2014":9.669166564941406,"tavg2015":9.998332977294922,"tavg2016":10.327500343322754,"tavg2017":11.28416633605957,"tavg2018":12.774999618530273},{"RegionName":"89138","RecentPrice":"0.97","population":12118,"avgstar":"4.65","ptr":"17.63","avg2014":0.7989588975906372,"avg2015":0.8332934379577637,"avg2016":0.851273238658905,"avg2017":0.9117705821990967,"avg2018":0.9646105766296387,"tavg2014":15.37833309173584,"tavg2015":15.744166374206543,"tavg2016":16.012500762939453,"tavg2017":16.588333129882812,"tavg2018":17.63249969482422},{"RegionName":"89128","RecentPrice":"0.97","population":35669,"avgstar":"3.66","ptr":"16.03","avg2014":0.7474514842033386,"avg2015":0.7737227082252502,"avg2016":0.8352106809616089,"avg2017":0.9088505506515503,"avg2018":0.9378980398178101,"tavg2014":12.262499809265137,"tavg2015":12.635833740234375,"tavg2016":13.0600004196167,"tavg2017":14.322500228881836,"tavg2018":15.96166706085205},{"RegionName":"89120","RecentPrice":"0.96","population":23311,"avgstar":"3.84","ptr":"16.12","avg2014":0.8413026332855225,"avg2015":0.8413026332855225,"avg2016":0.7516874670982361,"avg2017":0.8423246741294861,"avg2018":0.92989581823349,"tavg2014":11.404999732971191,"tavg2015":12.249166488647461,"tavg2016":13.387499809265137,"tavg2017":14.657500267028809,"tavg2018":16.030000686645508},{"RegionName":"89183","RecentPrice":"0.95","population":36005,"avgstar":"3.64","ptr":"16.48","avg2014":0.7416207194328308,"avg2015":0.762516975402832,"avg2016":0.8097556233406067,"avg2017":0.8525806665420532,"avg2018":0.9269351959228516,"tavg2014":12.641666412353516,"tavg2015":13.223333358764648,"tavg2016":14.15916633605957,"tavg2017":15.269166946411133,"tavg2018":16.49416732788086},{"RegionName":"89147","RecentPrice":"0.95","population":49778,"avgstar":"3.94","ptr":"16.62","avg2014":0.7494592070579529,"avg2015":0.7777810096740723,"avg2016":0.8113617300987244,"avg2017":0.861248791217804,"avg2018":0.9220598936080933,"tavg2014":12.892499923706055,"tavg2015":13.625,"tavg2016":14.35083293914795,"tavg2017":15.399999618530273,"tavg2018":16.69416618347168},{"RegionName":"89108","RecentPrice":"0.91","population":70123,"avgstar":"3.40","ptr":"15.26","avg2014":0.7095445394515991,"avg2015":0.7359171509742737,"avg2016":0.7513868808746338,"avg2017":0.8347228765487671,"avg2018":0.8741915822029114,"tavg2014":10.59083366394043,"tavg2015":11.249166488647461,"tavg2016":12.044166564941406,"tavg2017":13.007499694824219,"tavg2018":14.729999542236328},{"RegionName":"89166","RecentPrice":"0.91","population":13209,"avgstar":"4.17","ptr":"16.52","avg2014":0.6863433718681335,"avg2015":0.7102497220039368,"avg2016":0.729561984539032,"avg2017":0.7767935395240784,"avg2018":0.8413708209991455,"tavg2014":13.525833129882812,"tavg2015":13.765832901000977,"tavg2016":14.460833549499512,"tavg2017":15.431666374206543,"tavg2018":16.532499313354492},{"RegionName":"89142","RecentPrice":"0.90","population":33731,"avgstar":"3.75","ptr":"15.19","avg2014":0.7044141888618469,"avg2015":0.7196412682533264,"avg2016":0.7545318603515625,"avg2017":0.8191232681274414,"avg2018":0.8653101921081543,"tavg2014":10.5649995803833,"tavg2015":11.483333587646484,"tavg2016":12.213333129882812,"tavg2017":13.183333396911621,"tavg2018":14.779999732971191},{"RegionName":"89130","RecentPrice":"0.89","population":33015,"avgstar":"3.69","ptr":"16.52","avg2014":0.6966119408607483,"avg2015":0.7121387124061584,"avg2016":0.7405145764350891,"avg2017":0.7890192866325378,"avg2018":0.8563268780708313,"tavg2014":12.932499885559082,"tavg2015":13.587499618530273,"tavg2016":14.164166450500488,"tavg2017":15.269166946411133,"tavg2018":16.52750015258789},{"RegionName":"89121","RecentPrice":"0.89","population":64096,"avgstar":"3.46","ptr":"14.38","avg2014":0.657243549823761,"avg2015":0.6877008676528931,"avg2016":0.7101393342018127,"avg2017":0.7662110328674316,"avg2018":0.8509666919708252,"tavg2014":9.973333358764648,"tavg2015":10.69083309173584,"tavg2016":11.46916675567627,"tavg2017":12.691666603088379,"tavg2018":14.172499656677246},{"RegionName":"89122","RecentPrice":"0.89","population":45720,"avgstar":"3.30","ptr":"14.84","avg2014":0.676971435546875,"avg2015":0.6963284015655518,"avg2016":0.7178817987442017,"avg2017":0.7704246640205383,"avg2018":0.8320196270942688,"tavg2014":10.758333206176758,"tavg2015":11.55916690826416,"tavg2016":12.10083293914795,"tavg2017":12.842499732971191,"tavg2018":14.400833129882812},{"RegionName":"89104","RecentPrice":"0.88","population":39909,"avgstar":"3.63","ptr":"13.35","avg2014":0.8410785794258118,"avg2015":0.8410785794258118,"avg2016":0.8410785794258118,"avg2017":0.8120689988136292,"avg2018":0.8700881004333496,"tavg2014":9.59333324432373,"tavg2015":10.213333129882812,"tavg2016":11.010000228881836,"tavg2017":12.208333015441895,"tavg2018":13.657500267028809},{"RegionName":"89129","RecentPrice":"0.87","population":51252,"avgstar":"3.77","ptr":"16.62","avg2014":0.7081557512283325,"avg2015":0.7308351993560791,"avg2016":0.7524811625480652,"avg2017":0.790669322013855,"avg2018":0.8485556244850159,"tavg2014":13.255833625793457,"tavg2015":13.838333129882812,"tavg2016":14.385833740234375,"tavg2017":15.40583324432373,"tavg2018":16.665000915527344},{"RegionName":"89141","RecentPrice":"0.87","population":25150,"avgstar":"3.99","ptr":"17.32","avg2014":0.6919839382171631,"avg2015":0.7040865421295166,"avg2016":0.718996524810791,"avg2017":0.7648734450340271,"avg2018":0.813056468963623,"tavg2014":14.404999732971191,"tavg2015":14.875,"tavg2016":15.268333435058594,"tavg2017":16.0625,"tavg2018":17.213333129882812},{"RegionName":"89149","RecentPrice":"0.86","population":31143,"avgstar":"3.60","ptr":"16.55","avg2014":0.6813015341758728,"avg2015":0.7067763805389404,"avg2016":0.7433902025222778,"avg2017":0.799675703048706,"avg2018":0.8463039398193359,"tavg2014":13.401666641235352,"tavg2015":13.885833740234375,"tavg2016":14.338333129882812,"tavg2017":15.416666984558105,"tavg2018":16.559999465942383},{"RegionName":"89156","RecentPrice":"0.86","population":27794,"avgstar":"3.00","ptr":"15.16","avg2014":0.6526474356651306,"avg2015":0.6635021567344666,"avg2016":0.7053105235099792,"avg2017":0.7761400938034058,"avg2018":0.8394015431404114,"tavg2014":10.507499694824219,"tavg2015":11.357500076293945,"tavg2016":12.296667098999023,"tavg2017":13.040833473205566,"tavg2018":14.561666488647461},{"RegionName":"89110","RecentPrice":"0.85","population":70994,"avgstar":"3.49","ptr":"14.99","avg2014":0.6837406754493713,"avg2015":0.6922223567962646,"avg2016":0.7097086310386658,"avg2017":0.7609897255897522,"avg2018":0.8191784620285034,"tavg2014":10.060832977294922,"tavg2015":11.048333168029785,"tavg2016":11.864166259765625,"tavg2017":12.678333282470703,"tavg2018":14.397500038146973},{"RegionName":"89178","RecentPrice":"0.85","population":27588,"avgstar":"4.11","ptr":"17.17","avg2014":0.6741873621940613,"avg2015":0.6937595009803772,"avg2016":0.7193278074264526,"avg2017":0.7436912655830383,"avg2018":0.7974264025688171,"tavg2014":14.180832862854004,"tavg2015":14.701666831970215,"tavg2016":15.132499694824219,"tavg2017":15.967499732971191,"tavg2018":17.104999542236328},{"RegionName":"89139","RecentPrice":"0.83","population":30477,"avgstar":"3.79","ptr":"17.12","avg2014":0.6824887990951538,"avg2015":0.7014032006263733,"avg2016":0.7228863835334778,"avg2017":0.7523400783538818,"avg2018":0.8049191832542419,"tavg2014":13.914166450500488,"tavg2015":14.50333309173584,"tavg2016":14.845833778381348,"tavg2017":15.789999961853027,"tavg2018":16.947500228881836},{"RegionName":"89131","RecentPrice":"0.82","population":43072,"avgstar":"3.69","ptr":"17.08","avg2014":0.6734561920166016,"avg2015":0.6971559524536133,"avg2016":0.7139505743980408,"avg2017":0.7506279945373535,"avg2018":0.7998023629188538,"tavg2014":14.245833396911621,"tavg2015":14.78833293914795,"tavg2016":15.051666259765625,"tavg2017":16.054166793823242,"tavg2018":17.116666793823242},{"RegionName":"89148","RecentPrice":"0.82","population":39712,"avgstar":"3.85","ptr":"17.30","avg2014":0.7036188244819641,"avg2015":0.7218939661979675,"avg2016":0.7380779981613159,"avg2017":0.777169406414032,"avg2018":0.8220404982566833,"tavg2014":14.169166564941406,"tavg2015":14.725000381469727,"tavg2016":15.068333625793457,"tavg2017":16.04083251953125,"tavg2018":17.20916748046875},{"RegionName":"89143","RecentPrice":"0.81","population":12786,"avgstar":"3.67","ptr":"16.69","avg2014":0.7565176486968994,"avg2015":0.7565176486968994,"avg2016":0.6994818449020386,"avg2017":0.7634060382843018,"avg2018":0.8066651225090027,"tavg2014":13.341666221618652,"tavg2015":13.946666717529297,"tavg2016":14.450833320617676,"tavg2017":15.561666488647461,"tavg2018":16.68083381652832}];
  var pt_buy=[{"RegionName":"89169","RecentPrice":"1.72","population":23304,"avgstar":"3.33","ptr":"11.32","avg2014":1.6083205938339233,"avg2015":1.5468566417694092,"avg2016":1.6335469484329224,"avg2017":1.6176891326904297,"avg2018":1.6351896524429321,"tavg2014":9.136666297912598,"tavg2015":9.512499809265137,"tavg2016":9.330833435058594,"tavg2017":9.853333473205566,"tavg2018":11.239166259765625},{"RegionName":"89109","RecentPrice":"1.54","population":7770,"avgstar":"3.63","ptr":"12.48","avg2014":1.5097460746765137,"avg2015":1.4984248876571655,"avg2016":1.5436429977416992,"avg2017":1.513492226600647,"avg2018":1.5682491064071655,"tavg2014":13.595000267028809,"tavg2015":14.295833587646484,"tavg2016":11.875833511352539,"tavg2017":12.823333740234375,"tavg2018":13.925000190734863},{"RegionName":"89103","RecentPrice":"1.21","population":50519,"avgstar":"3.67","ptr":"12.51","avg2014":0.8503755927085876,"avg2015":0.9233481287956238,"avg2016":0.9588871002197266,"avg2017":1.0820794105529785,"avg2018":1.1647777557373047,"tavg2014":9.920000076293945,"tavg2015":10.119166374206543,"tavg2016":9.907500267028809,"tavg2017":11.045833587646484,"tavg2018":12.760833740234375},{"RegionName":"89113","RecentPrice":"1.07","population":23800,"avgstar":"3.81","ptr":"16.81","avg2014":0.7967632412910461,"avg2015":0.8045395016670227,"avg2016":0.8425643444061279,"avg2017":0.8975192904472351,"avg2018":1.006705403327942,"tavg2014":13.394166946411133,"tavg2015":14.056666374206543,"tavg2016":14.410833358764648,"tavg2017":15.546667098999023,"tavg2018":16.655834197998047},{"RegionName":"89123","RecentPrice":"1.06","population":56300,"avgstar":"3.72","ptr":"16.86","avg2014":0.8215013146400452,"avg2015":0.854698657989502,"avg2016":0.8853554725646973,"avg2017":0.9568476676940918,"avg2018":1.0249707698822021,"tavg2014":13.449166297912598,"tavg2015":14.079166412353516,"tavg2016":14.804166793823242,"tavg2017":15.677499771118164,"tavg2018":16.815000534057617},{"RegionName":"89134","RecentPrice":"1.04","population":24040,"avgstar":"4.02","ptr":"17.36","avg2014":0.8119620680809021,"avg2015":0.8531567454338074,"avg2016":0.8967577219009399,"avg2017":0.9469965696334839,"avg2018":1.0061496496200562,"tavg2014":15.015000343322754,"tavg2015":15.144166946411133,"tavg2016":15.337499618530273,"tavg2017":16.289167404174805,"tavg2018":17.328332901000977},{"RegionName":"89144","RecentPrice":"1.04","population":18714,"avgstar":"3.81","ptr":"17.26","avg2014":0.8475954532623291,"avg2015":0.8796624541282654,"avg2016":0.9048879146575928,"avg2017":0.9544352293014526,"avg2018":1.029609203338623,"tavg2014":14.938333511352539,"tavg2015":15.279166221618652,"tavg2016":15.463333129882812,"tavg2017":16.149999618530273,"tavg2018":17.29083251953125},{"RegionName":"89118","RecentPrice":"1.04","population":19318,"avgstar":"3.92","ptr":"14.57","avg2014":0.7842627167701721,"avg2015":0.8250160217285156,"avg2016":0.8759748935699463,"avg2017":0.9775651693344116,"avg2018":0.9991613030433655,"tavg2014":10.713333129882812,"tavg2015":11.481666564941406,"tavg2016":12.207500457763672,"tavg2017":12.960000038146973,"tavg2018":14.300833702087402},{"RegionName":"89135","RecentPrice":"1.00","population":24144,"avgstar":"3.86","ptr":"17.68","avg2014":0.8386094570159912,"avg2015":0.8707769513130188,"avg2016":0.8993099331855774,"avg2017":0.9339646100997925,"avg2018":0.9896814227104187,"tavg2014":15.389166831970215,"tavg2015":15.757499694824219,"tavg2016":15.995833396911621,"tavg2017":16.606666564941406,"tavg2018":17.684165954589844},{"RegionName":"89117","RecentPrice":"0.99","population":55416,"avgstar":"3.84","ptr":"17.04","avg2014":0.7489374876022339,"avg2015":0.7857064604759216,"avg2016":0.8207190632820129,"avg2017":0.873504102230072,"avg2018":0.9569958448410034,"tavg2014":14.43416690826416,"tavg2015":14.801666259765625,"tavg2016":15.316666603088379,"tavg2017":16.165000915527344,"tavg2018":17.1825008392334},{"RegionName":"89145","RecentPrice":"0.99","population":23186,"avgstar":"3.76","ptr":"16.04","avg2014":0.7637144923210144,"avg2015":0.792255699634552,"avg2016":0.8254902958869934,"avg2017":0.9088305830955505,"avg2018":0.9407517313957214,"tavg2014":11.425000190734863,"tavg2015":12.079166412353516,"tavg2016":12.83666706085205,"tavg2017":14.165833473205566,"tavg2018":15.732500076293945},{"RegionName":"89107","RecentPrice":"0.98","population":36282,"avgstar":"3.44","ptr":"12.71","avg2014":0.6994535326957703,"avg2015":0.7239341139793396,"avg2016":0.769247829914093,"avg2017":0.8319344520568848,"avg2018":0.9421302080154419,"tavg2014":9.669166564941406,"tavg2015":9.998332977294922,"tavg2016":10.327500343322754,"tavg2017":11.28416633605957,"tavg2018":12.774999618530273},{"RegionName":"89138","RecentPrice":"0.97","population":12118,"avgstar":"4.65","ptr":"17.63","avg2014":0.7989588975906372,"avg2015":0.8332934379577637,"avg2016":0.851273238658905,"avg2017":0.9117705821990967,"avg2018":0.9646105766296387,"tavg2014":15.37833309173584,"tavg2015":15.744166374206543,"tavg2016":16.012500762939453,"tavg2017":16.588333129882812,"tavg2018":17.63249969482422},{"RegionName":"89128","RecentPrice":"0.97","population":35669,"avgstar":"3.66","ptr":"16.03","avg2014":0.7474514842033386,"avg2015":0.7737227082252502,"avg2016":0.8352106809616089,"avg2017":0.9088505506515503,"avg2018":0.9378980398178101,"tavg2014":12.262499809265137,"tavg2015":12.635833740234375,"tavg2016":13.0600004196167,"tavg2017":14.322500228881836,"tavg2018":15.96166706085205},{"RegionName":"89120","RecentPrice":"0.96","population":23311,"avgstar":"3.84","ptr":"16.12","avg2014":0.8413026332855225,"avg2015":0.8413026332855225,"avg2016":0.7516874670982361,"avg2017":0.8423246741294861,"avg2018":0.92989581823349,"tavg2014":11.404999732971191,"tavg2015":12.249166488647461,"tavg2016":13.387499809265137,"tavg2017":14.657500267028809,"tavg2018":16.030000686645508},{"RegionName":"89183","RecentPrice":"0.95","population":36005,"avgstar":"3.64","ptr":"16.48","avg2014":0.7416207194328308,"avg2015":0.762516975402832,"avg2016":0.8097556233406067,"avg2017":0.8525806665420532,"avg2018":0.9269351959228516,"tavg2014":12.641666412353516,"tavg2015":13.223333358764648,"tavg2016":14.15916633605957,"tavg2017":15.269166946411133,"tavg2018":16.49416732788086},{"RegionName":"89147","RecentPrice":"0.95","population":49778,"avgstar":"3.94","ptr":"16.62","avg2014":0.7494592070579529,"avg2015":0.7777810096740723,"avg2016":0.8113617300987244,"avg2017":0.861248791217804,"avg2018":0.9220598936080933,"tavg2014":12.892499923706055,"tavg2015":13.625,"tavg2016":14.35083293914795,"tavg2017":15.399999618530273,"tavg2018":16.69416618347168},{"RegionName":"89108","RecentPrice":"0.91","population":70123,"avgstar":"3.40","ptr":"15.26","avg2014":0.7095445394515991,"avg2015":0.7359171509742737,"avg2016":0.7513868808746338,"avg2017":0.8347228765487671,"avg2018":0.8741915822029114,"tavg2014":10.59083366394043,"tavg2015":11.249166488647461,"tavg2016":12.044166564941406,"tavg2017":13.007499694824219,"tavg2018":14.729999542236328},{"RegionName":"89166","RecentPrice":"0.91","population":13209,"avgstar":"4.17","ptr":"16.52","avg2014":0.6863433718681335,"avg2015":0.7102497220039368,"avg2016":0.729561984539032,"avg2017":0.7767935395240784,"avg2018":0.8413708209991455,"tavg2014":13.525833129882812,"tavg2015":13.765832901000977,"tavg2016":14.460833549499512,"tavg2017":15.431666374206543,"tavg2018":16.532499313354492},{"RegionName":"89142","RecentPrice":"0.90","population":33731,"avgstar":"3.75","ptr":"15.19","avg2014":0.7044141888618469,"avg2015":0.7196412682533264,"avg2016":0.7545318603515625,"avg2017":0.8191232681274414,"avg2018":0.8653101921081543,"tavg2014":10.5649995803833,"tavg2015":11.483333587646484,"tavg2016":12.213333129882812,"tavg2017":13.183333396911621,"tavg2018":14.779999732971191},{"RegionName":"89130","RecentPrice":"0.89","population":33015,"avgstar":"3.69","ptr":"16.52","avg2014":0.6966119408607483,"avg2015":0.7121387124061584,"avg2016":0.7405145764350891,"avg2017":0.7890192866325378,"avg2018":0.8563268780708313,"tavg2014":12.932499885559082,"tavg2015":13.587499618530273,"tavg2016":14.164166450500488,"tavg2017":15.269166946411133,"tavg2018":16.52750015258789},{"RegionName":"89121","RecentPrice":"0.89","population":64096,"avgstar":"3.46","ptr":"14.38","avg2014":0.657243549823761,"avg2015":0.6877008676528931,"avg2016":0.7101393342018127,"avg2017":0.7662110328674316,"avg2018":0.8509666919708252,"tavg2014":9.973333358764648,"tavg2015":10.69083309173584,"tavg2016":11.46916675567627,"tavg2017":12.691666603088379,"tavg2018":14.172499656677246},{"RegionName":"89122","RecentPrice":"0.89","population":45720,"avgstar":"3.30","ptr":"14.84","avg2014":0.676971435546875,"avg2015":0.6963284015655518,"avg2016":0.7178817987442017,"avg2017":0.7704246640205383,"avg2018":0.8320196270942688,"tavg2014":10.758333206176758,"tavg2015":11.55916690826416,"tavg2016":12.10083293914795,"tavg2017":12.842499732971191,"tavg2018":14.400833129882812},{"RegionName":"89104","RecentPrice":"0.88","population":39909,"avgstar":"3.63","ptr":"13.35","avg2014":0.8410785794258118,"avg2015":0.8410785794258118,"avg2016":0.8410785794258118,"avg2017":0.8120689988136292,"avg2018":0.8700881004333496,"tavg2014":9.59333324432373,"tavg2015":10.213333129882812,"tavg2016":11.010000228881836,"tavg2017":12.208333015441895,"tavg2018":13.657500267028809},{"RegionName":"89129","RecentPrice":"0.87","population":51252,"avgstar":"3.77","ptr":"16.62","avg2014":0.7081557512283325,"avg2015":0.7308351993560791,"avg2016":0.7524811625480652,"avg2017":0.790669322013855,"avg2018":0.8485556244850159,"tavg2014":13.255833625793457,"tavg2015":13.838333129882812,"tavg2016":14.385833740234375,"tavg2017":15.40583324432373,"tavg2018":16.665000915527344},{"RegionName":"89141","RecentPrice":"0.87","population":25150,"avgstar":"3.99","ptr":"17.32","avg2014":0.6919839382171631,"avg2015":0.7040865421295166,"avg2016":0.718996524810791,"avg2017":0.7648734450340271,"avg2018":0.813056468963623,"tavg2014":14.404999732971191,"tavg2015":14.875,"tavg2016":15.268333435058594,"tavg2017":16.0625,"tavg2018":17.213333129882812},{"RegionName":"89149","RecentPrice":"0.86","population":31143,"avgstar":"3.60","ptr":"16.55","avg2014":0.6813015341758728,"avg2015":0.7067763805389404,"avg2016":0.7433902025222778,"avg2017":0.799675703048706,"avg2018":0.8463039398193359,"tavg2014":13.401666641235352,"tavg2015":13.885833740234375,"tavg2016":14.338333129882812,"tavg2017":15.416666984558105,"tavg2018":16.559999465942383},{"RegionName":"89156","RecentPrice":"0.86","population":27794,"avgstar":"3.00","ptr":"15.16","avg2014":0.6526474356651306,"avg2015":0.6635021567344666,"avg2016":0.7053105235099792,"avg2017":0.7761400938034058,"avg2018":0.8394015431404114,"tavg2014":10.507499694824219,"tavg2015":11.357500076293945,"tavg2016":12.296667098999023,"tavg2017":13.040833473205566,"tavg2018":14.561666488647461},{"RegionName":"89110","RecentPrice":"0.85","population":70994,"avgstar":"3.49","ptr":"14.99","avg2014":0.6837406754493713,"avg2015":0.6922223567962646,"avg2016":0.7097086310386658,"avg2017":0.7609897255897522,"avg2018":0.8191784620285034,"tavg2014":10.060832977294922,"tavg2015":11.048333168029785,"tavg2016":11.864166259765625,"tavg2017":12.678333282470703,"tavg2018":14.397500038146973},{"RegionName":"89178","RecentPrice":"0.85","population":27588,"avgstar":"4.11","ptr":"17.17","avg2014":0.6741873621940613,"avg2015":0.6937595009803772,"avg2016":0.7193278074264526,"avg2017":0.7436912655830383,"avg2018":0.7974264025688171,"tavg2014":14.180832862854004,"tavg2015":14.701666831970215,"tavg2016":15.132499694824219,"tavg2017":15.967499732971191,"tavg2018":17.104999542236328},{"RegionName":"89139","RecentPrice":"0.83","population":30477,"avgstar":"3.79","ptr":"17.12","avg2014":0.6824887990951538,"avg2015":0.7014032006263733,"avg2016":0.7228863835334778,"avg2017":0.7523400783538818,"avg2018":0.8049191832542419,"tavg2014":13.914166450500488,"tavg2015":14.50333309173584,"tavg2016":14.845833778381348,"tavg2017":15.789999961853027,"tavg2018":16.947500228881836},{"RegionName":"89131","RecentPrice":"0.82","population":43072,"avgstar":"3.69","ptr":"17.08","avg2014":0.6734561920166016,"avg2015":0.6971559524536133,"avg2016":0.7139505743980408,"avg2017":0.7506279945373535,"avg2018":0.7998023629188538,"tavg2014":14.245833396911621,"tavg2015":14.78833293914795,"tavg2016":15.051666259765625,"tavg2017":16.054166793823242,"tavg2018":17.116666793823242},{"RegionName":"89148","RecentPrice":"0.82","population":39712,"avgstar":"3.85","ptr":"17.30","avg2014":0.7036188244819641,"avg2015":0.7218939661979675,"avg2016":0.7380779981613159,"avg2017":0.777169406414032,"avg2018":0.8220404982566833,"tavg2014":14.169166564941406,"tavg2015":14.725000381469727,"tavg2016":15.068333625793457,"tavg2017":16.04083251953125,"tavg2018":17.20916748046875},{"RegionName":"89143","RecentPrice":"0.81","population":12786,"avgstar":"3.67","ptr":"16.69","avg2014":0.7565176486968994,"avg2015":0.7565176486968994,"avg2016":0.6994818449020386,"avg2017":0.7634060382843018,"avg2018":0.8066651225090027,"tavg2014":13.341666221618652,"tavg2015":13.946666717529297,"tavg2016":14.450833320617676,"tavg2017":15.561666488647461,"tavg2018":16.68083381652832}];
  var pt_rent=[{"RegionName":"89169","RecentPrice":"1.72","population":23304,"avgstar":"3.33","ptr":"11.32","avg2014":1.6083205938339233,"avg2015":1.5468566417694092,"avg2016":1.6335469484329224,"avg2017":1.6176891326904297,"avg2018":1.6351896524429321,"tavg2014":9.136666297912598,"tavg2015":9.512499809265137,"tavg2016":9.330833435058594,"tavg2017":9.853333473205566,"tavg2018":11.239166259765625},{"RegionName":"89109","RecentPrice":"1.54","population":7770,"avgstar":"3.63","ptr":"12.48","avg2014":1.5097460746765137,"avg2015":1.4984248876571655,"avg2016":1.5436429977416992,"avg2017":1.513492226600647,"avg2018":1.5682491064071655,"tavg2014":13.595000267028809,"tavg2015":14.295833587646484,"tavg2016":11.875833511352539,"tavg2017":12.823333740234375,"tavg2018":13.925000190734863},{"RegionName":"89103","RecentPrice":"1.21","population":50519,"avgstar":"3.67","ptr":"12.51","avg2014":0.8503755927085876,"avg2015":0.9233481287956238,"avg2016":0.9588871002197266,"avg2017":1.0820794105529785,"avg2018":1.1647777557373047,"tavg2014":9.920000076293945,"tavg2015":10.119166374206543,"tavg2016":9.907500267028809,"tavg2017":11.045833587646484,"tavg2018":12.760833740234375},{"RegionName":"89113","RecentPrice":"1.07","population":23800,"avgstar":"3.81","ptr":"16.81","avg2014":0.7967632412910461,"avg2015":0.8045395016670227,"avg2016":0.8425643444061279,"avg2017":0.8975192904472351,"avg2018":1.006705403327942,"tavg2014":13.394166946411133,"tavg2015":14.056666374206543,"tavg2016":14.410833358764648,"tavg2017":15.546667098999023,"tavg2018":16.655834197998047},{"RegionName":"89123","RecentPrice":"1.06","population":56300,"avgstar":"3.72","ptr":"16.86","avg2014":0.8215013146400452,"avg2015":0.854698657989502,"avg2016":0.8853554725646973,"avg2017":0.9568476676940918,"avg2018":1.0249707698822021,"tavg2014":13.449166297912598,"tavg2015":14.079166412353516,"tavg2016":14.804166793823242,"tavg2017":15.677499771118164,"tavg2018":16.815000534057617},{"RegionName":"89134","RecentPrice":"1.04","population":24040,"avgstar":"4.02","ptr":"17.36","avg2014":0.8119620680809021,"avg2015":0.8531567454338074,"avg2016":0.8967577219009399,"avg2017":0.9469965696334839,"avg2018":1.0061496496200562,"tavg2014":15.015000343322754,"tavg2015":15.144166946411133,"tavg2016":15.337499618530273,"tavg2017":16.289167404174805,"tavg2018":17.328332901000977},{"RegionName":"89144","RecentPrice":"1.04","population":18714,"avgstar":"3.81","ptr":"17.26","avg2014":0.8475954532623291,"avg2015":0.8796624541282654,"avg2016":0.9048879146575928,"avg2017":0.9544352293014526,"avg2018":1.029609203338623,"tavg2014":14.938333511352539,"tavg2015":15.279166221618652,"tavg2016":15.463333129882812,"tavg2017":16.149999618530273,"tavg2018":17.29083251953125},{"RegionName":"89118","RecentPrice":"1.04","population":19318,"avgstar":"3.92","ptr":"14.57","avg2014":0.7842627167701721,"avg2015":0.8250160217285156,"avg2016":0.8759748935699463,"avg2017":0.9775651693344116,"avg2018":0.9991613030433655,"tavg2014":10.713333129882812,"tavg2015":11.481666564941406,"tavg2016":12.207500457763672,"tavg2017":12.960000038146973,"tavg2018":14.300833702087402},{"RegionName":"89135","RecentPrice":"1.00","population":24144,"avgstar":"3.86","ptr":"17.68","avg2014":0.8386094570159912,"avg2015":0.8707769513130188,"avg2016":0.8993099331855774,"avg2017":0.9339646100997925,"avg2018":0.9896814227104187,"tavg2014":15.389166831970215,"tavg2015":15.757499694824219,"tavg2016":15.995833396911621,"tavg2017":16.606666564941406,"tavg2018":17.684165954589844},{"RegionName":"89117","RecentPrice":"0.99","population":55416,"avgstar":"3.84","ptr":"17.04","avg2014":0.7489374876022339,"avg2015":0.7857064604759216,"avg2016":0.8207190632820129,"avg2017":0.873504102230072,"avg2018":0.9569958448410034,"tavg2014":14.43416690826416,"tavg2015":14.801666259765625,"tavg2016":15.316666603088379,"tavg2017":16.165000915527344,"tavg2018":17.1825008392334},{"RegionName":"89145","RecentPrice":"0.99","population":23186,"avgstar":"3.76","ptr":"16.04","avg2014":0.7637144923210144,"avg2015":0.792255699634552,"avg2016":0.8254902958869934,"avg2017":0.9088305830955505,"avg2018":0.9407517313957214,"tavg2014":11.425000190734863,"tavg2015":12.079166412353516,"tavg2016":12.83666706085205,"tavg2017":14.165833473205566,"tavg2018":15.732500076293945},{"RegionName":"89107","RecentPrice":"0.98","population":36282,"avgstar":"3.44","ptr":"12.71","avg2014":0.6994535326957703,"avg2015":0.7239341139793396,"avg2016":0.769247829914093,"avg2017":0.8319344520568848,"avg2018":0.9421302080154419,"tavg2014":9.669166564941406,"tavg2015":9.998332977294922,"tavg2016":10.327500343322754,"tavg2017":11.28416633605957,"tavg2018":12.774999618530273},{"RegionName":"89138","RecentPrice":"0.97","population":12118,"avgstar":"4.65","ptr":"17.63","avg2014":0.7989588975906372,"avg2015":0.8332934379577637,"avg2016":0.851273238658905,"avg2017":0.9117705821990967,"avg2018":0.9646105766296387,"tavg2014":15.37833309173584,"tavg2015":15.744166374206543,"tavg2016":16.012500762939453,"tavg2017":16.588333129882812,"tavg2018":17.63249969482422},{"RegionName":"89128","RecentPrice":"0.97","population":35669,"avgstar":"3.66","ptr":"16.03","avg2014":0.7474514842033386,"avg2015":0.7737227082252502,"avg2016":0.8352106809616089,"avg2017":0.9088505506515503,"avg2018":0.9378980398178101,"tavg2014":12.262499809265137,"tavg2015":12.635833740234375,"tavg2016":13.0600004196167,"tavg2017":14.322500228881836,"tavg2018":15.96166706085205},{"RegionName":"89120","RecentPrice":"0.96","population":23311,"avgstar":"3.84","ptr":"16.12","avg2014":0.8413026332855225,"avg2015":0.8413026332855225,"avg2016":0.7516874670982361,"avg2017":0.8423246741294861,"avg2018":0.92989581823349,"tavg2014":11.404999732971191,"tavg2015":12.249166488647461,"tavg2016":13.387499809265137,"tavg2017":14.657500267028809,"tavg2018":16.030000686645508},{"RegionName":"89183","RecentPrice":"0.95","population":36005,"avgstar":"3.64","ptr":"16.48","avg2014":0.7416207194328308,"avg2015":0.762516975402832,"avg2016":0.8097556233406067,"avg2017":0.8525806665420532,"avg2018":0.9269351959228516,"tavg2014":12.641666412353516,"tavg2015":13.223333358764648,"tavg2016":14.15916633605957,"tavg2017":15.269166946411133,"tavg2018":16.49416732788086},{"RegionName":"89147","RecentPrice":"0.95","population":49778,"avgstar":"3.94","ptr":"16.62","avg2014":0.7494592070579529,"avg2015":0.7777810096740723,"avg2016":0.8113617300987244,"avg2017":0.861248791217804,"avg2018":0.9220598936080933,"tavg2014":12.892499923706055,"tavg2015":13.625,"tavg2016":14.35083293914795,"tavg2017":15.399999618530273,"tavg2018":16.69416618347168},{"RegionName":"89108","RecentPrice":"0.91","population":70123,"avgstar":"3.40","ptr":"15.26","avg2014":0.7095445394515991,"avg2015":0.7359171509742737,"avg2016":0.7513868808746338,"avg2017":0.8347228765487671,"avg2018":0.8741915822029114,"tavg2014":10.59083366394043,"tavg2015":11.249166488647461,"tavg2016":12.044166564941406,"tavg2017":13.007499694824219,"tavg2018":14.729999542236328},{"RegionName":"89166","RecentPrice":"0.91","population":13209,"avgstar":"4.17","ptr":"16.52","avg2014":0.6863433718681335,"avg2015":0.7102497220039368,"avg2016":0.729561984539032,"avg2017":0.7767935395240784,"avg2018":0.8413708209991455,"tavg2014":13.525833129882812,"tavg2015":13.765832901000977,"tavg2016":14.460833549499512,"tavg2017":15.431666374206543,"tavg2018":16.532499313354492},{"RegionName":"89142","RecentPrice":"0.90","population":33731,"avgstar":"3.75","ptr":"15.19","avg2014":0.7044141888618469,"avg2015":0.7196412682533264,"avg2016":0.7545318603515625,"avg2017":0.8191232681274414,"avg2018":0.8653101921081543,"tavg2014":10.5649995803833,"tavg2015":11.483333587646484,"tavg2016":12.213333129882812,"tavg2017":13.183333396911621,"tavg2018":14.779999732971191},{"RegionName":"89130","RecentPrice":"0.89","population":33015,"avgstar":"3.69","ptr":"16.52","avg2014":0.6966119408607483,"avg2015":0.7121387124061584,"avg2016":0.7405145764350891,"avg2017":0.7890192866325378,"avg2018":0.8563268780708313,"tavg2014":12.932499885559082,"tavg2015":13.587499618530273,"tavg2016":14.164166450500488,"tavg2017":15.269166946411133,"tavg2018":16.52750015258789},{"RegionName":"89121","RecentPrice":"0.89","population":64096,"avgstar":"3.46","ptr":"14.38","avg2014":0.657243549823761,"avg2015":0.6877008676528931,"avg2016":0.7101393342018127,"avg2017":0.7662110328674316,"avg2018":0.8509666919708252,"tavg2014":9.973333358764648,"tavg2015":10.69083309173584,"tavg2016":11.46916675567627,"tavg2017":12.691666603088379,"tavg2018":14.172499656677246},{"RegionName":"89122","RecentPrice":"0.89","population":45720,"avgstar":"3.30","ptr":"14.84","avg2014":0.676971435546875,"avg2015":0.6963284015655518,"avg2016":0.7178817987442017,"avg2017":0.7704246640205383,"avg2018":0.8320196270942688,"tavg2014":10.758333206176758,"tavg2015":11.55916690826416,"tavg2016":12.10083293914795,"tavg2017":12.842499732971191,"tavg2018":14.400833129882812},{"RegionName":"89104","RecentPrice":"0.88","population":39909,"avgstar":"3.63","ptr":"13.35","avg2014":0.8410785794258118,"avg2015":0.8410785794258118,"avg2016":0.8410785794258118,"avg2017":0.8120689988136292,"avg2018":0.8700881004333496,"tavg2014":9.59333324432373,"tavg2015":10.213333129882812,"tavg2016":11.010000228881836,"tavg2017":12.208333015441895,"tavg2018":13.657500267028809},{"RegionName":"89129","RecentPrice":"0.87","population":51252,"avgstar":"3.77","ptr":"16.62","avg2014":0.7081557512283325,"avg2015":0.7308351993560791,"avg2016":0.7524811625480652,"avg2017":0.790669322013855,"avg2018":0.8485556244850159,"tavg2014":13.255833625793457,"tavg2015":13.838333129882812,"tavg2016":14.385833740234375,"tavg2017":15.40583324432373,"tavg2018":16.665000915527344},{"RegionName":"89141","RecentPrice":"0.87","population":25150,"avgstar":"3.99","ptr":"17.32","avg2014":0.6919839382171631,"avg2015":0.7040865421295166,"avg2016":0.718996524810791,"avg2017":0.7648734450340271,"avg2018":0.813056468963623,"tavg2014":14.404999732971191,"tavg2015":14.875,"tavg2016":15.268333435058594,"tavg2017":16.0625,"tavg2018":17.213333129882812},{"RegionName":"89149","RecentPrice":"0.86","population":31143,"avgstar":"3.60","ptr":"16.55","avg2014":0.6813015341758728,"avg2015":0.7067763805389404,"avg2016":0.7433902025222778,"avg2017":0.799675703048706,"avg2018":0.8463039398193359,"tavg2014":13.401666641235352,"tavg2015":13.885833740234375,"tavg2016":14.338333129882812,"tavg2017":15.416666984558105,"tavg2018":16.559999465942383},{"RegionName":"89156","RecentPrice":"0.86","population":27794,"avgstar":"3.00","ptr":"15.16","avg2014":0.6526474356651306,"avg2015":0.6635021567344666,"avg2016":0.7053105235099792,"avg2017":0.7761400938034058,"avg2018":0.8394015431404114,"tavg2014":10.507499694824219,"tavg2015":11.357500076293945,"tavg2016":12.296667098999023,"tavg2017":13.040833473205566,"tavg2018":14.561666488647461},{"RegionName":"89110","RecentPrice":"0.85","population":70994,"avgstar":"3.49","ptr":"14.99","avg2014":0.6837406754493713,"avg2015":0.6922223567962646,"avg2016":0.7097086310386658,"avg2017":0.7609897255897522,"avg2018":0.8191784620285034,"tavg2014":10.060832977294922,"tavg2015":11.048333168029785,"tavg2016":11.864166259765625,"tavg2017":12.678333282470703,"tavg2018":14.397500038146973},{"RegionName":"89178","RecentPrice":"0.85","population":27588,"avgstar":"4.11","ptr":"17.17","avg2014":0.6741873621940613,"avg2015":0.6937595009803772,"avg2016":0.7193278074264526,"avg2017":0.7436912655830383,"avg2018":0.7974264025688171,"tavg2014":14.180832862854004,"tavg2015":14.701666831970215,"tavg2016":15.132499694824219,"tavg2017":15.967499732971191,"tavg2018":17.104999542236328},{"RegionName":"89139","RecentPrice":"0.83","population":30477,"avgstar":"3.79","ptr":"17.12","avg2014":0.6824887990951538,"avg2015":0.7014032006263733,"avg2016":0.7228863835334778,"avg2017":0.7523400783538818,"avg2018":0.8049191832542419,"tavg2014":13.914166450500488,"tavg2015":14.50333309173584,"tavg2016":14.845833778381348,"tavg2017":15.789999961853027,"tavg2018":16.947500228881836},{"RegionName":"89131","RecentPrice":"0.82","population":43072,"avgstar":"3.69","ptr":"17.08","avg2014":0.6734561920166016,"avg2015":0.6971559524536133,"avg2016":0.7139505743980408,"avg2017":0.7506279945373535,"avg2018":0.7998023629188538,"tavg2014":14.245833396911621,"tavg2015":14.78833293914795,"tavg2016":15.051666259765625,"tavg2017":16.054166793823242,"tavg2018":17.116666793823242},{"RegionName":"89148","RecentPrice":"0.82","population":39712,"avgstar":"3.85","ptr":"17.30","avg2014":0.7036188244819641,"avg2015":0.7218939661979675,"avg2016":0.7380779981613159,"avg2017":0.777169406414032,"avg2018":0.8220404982566833,"tavg2014":14.169166564941406,"tavg2015":14.725000381469727,"tavg2016":15.068333625793457,"tavg2017":16.04083251953125,"tavg2018":17.20916748046875},{"RegionName":"89143","RecentPrice":"0.81","population":12786,"avgstar":"3.67","ptr":"16.69","avg2014":0.7565176486968994,"avg2015":0.7565176486968994,"avg2016":0.6994818449020386,"avg2017":0.7634060382843018,"avg2018":0.8066651225090027,"tavg2014":13.341666221618652,"tavg2015":13.946666717529297,"tavg2016":14.450833320617676,"tavg2017":15.561666488647461,"tavg2018":16.68083381652832}];
    if (state==="Nevada" && city==="Las Vegas" && bor==="RENT"){
    $scope.statesInfo=lv_rent;
  }
  else if (state==="Nevada" && city==="Las Vegas" && bor==="BUY"){
    $scope.statesInfo=lv_buy;
  }
  else if (state==="Pennsylvania" && city==="Pittsburgh" && bor==="RENT"){
    $scope.statesInfo=pt_rent;
  }
  else if (state==="Pennsylvania" && city==="Pittsburgh" && bor==="BUY"){
    $scope.statesInfo=pt_buy;
  }
  else{
    var request = $http.get('/userPreference/' + state + '/' + city + '/' + bor); 
    
    // var request = $http.get('/userPreference')
  request.success(function(response) {
    // success
  var jsonStr = JSON.stringify(response);
  console.log(jsonStr);
    $scope.statesInfo = response;
    // console.log("$scope.userInfo",$scope.userInfo);
  });
  
  request.error(function(response) {
    // failed
    console.log('err');
  });
  }
  };

  $scope.getService = function(input){
    
  var dataX = [2014, 2015, 2016, 2017, 2018];
  var dataY = [];
  var dataZ=[];
  dataY.push(parseFloat(input.avg2014));
  dataY.push(parseFloat(input.avg2015));
  dataY.push(parseFloat(input.avg2016));
  dataY.push(parseFloat(input.avg2017));
  dataY.push(parseFloat(input.avg2018));
  /*
  dataZ.push(parseFloat(Math.round(input.tavg2014* 100) / 100).toFixed(2));
  dataZ.push(parseFloat(Math.round(input.tavg2015* 100) / 100).toFixed(2));
  dataZ.push(parseFloat(Math.round(input.tavg2016* 100) / 100).toFixed(2));
  dataZ.push(parseFloat(Math.round(input.tavg2017* 100) / 100).toFixed(2));
  dataZ.push(parseFloat(Math.round(input.tavg2018* 100) / 100).toFixed(2));
  **/
  console.log(dataY);
 
  // $('#container').highcharts
  var chart = Highcharts.chart('container', {
    title: {
        text: 'Average Median List Price Per Sq Ft ($)(Past 5 years)',//标题
        x: -20 //center 设置标题的位置
    },
    subtitle: {
        text: 'Source: https://www.zillow.com/research/data/', //副标题
        x: -20 //副标题位置
    },
    credits:{//右下角的文本
        enabled: false,
        position: {//位置设置
            align: 'right',
            x: -10,
            y: -10
        },
        href: "http://www.highcharts.com",//点击文本时的链接
        style: {
            color:'blue'
        },
        text: "Highcharts Demo"//显示的内容
    },
    xAxis: {//横轴的数据
        categories: dataX
    },
    yAxis: {//纵轴的数据
        title: {
            text: 'Price Per Sq Ft ($/ft^2)'
        },
        plotLines: [{
            value: 0,
            width: 1,
        }]
    },
    tooltip: {//鼠标移到图形上时显示的提示框
        valueSuffix: '$/ft^2'
    },
    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle',
        enabled: false,//去掉右边的 name
        borderWidth: 0
    },
    series: [{
        name: 'Average Median Price',
        data: dataY
    }]
});
  
  var request = $http.get('/getService/'+input.RegionName );

    // var request = $http.get('/userPreference')
  request.success(function(response) {
    // success
    $scope.service = response;
    console.log("$scope.userInfo",$scope.userInfo);
  });
  
  request.error(function(response) {
    // failed
    console.log('err');
  });
  };

  
});

app.controller('mapController', function($scope, $http) {
  var lat;
  var lng;
  var map;
  var service_type = "";
  console.log('service',service_type);
  $scope.getLocate = function(input){  

    var zipcode = document.getElementById("zipcode").value; 
    var request = $http.get('/getLocate/'+ zipcode);
    console.log("getting zip "+zipcode);
    // var request = $http.get('/userPreference')
    request.success(function(response) {
      // success
      lat = response[0].lat;
      lng = response[0].lng;
      console.log("user location success " + lat);

      console.log('service',service_type);

      function initMap() {
        var Latlng = {lat: lat , lng: lng}
        console.log(Latlng)
        var mapInstance =  new google.maps.LatLng(lat, lng)
        map = new google.maps.Map(document.getElementById('map'), {
          center: Latlng,
          zoom: 17
        });
        infowindow = new google.maps.InfoWindow()
        
        map.addListener('click', function(e) {
            infowindow.open(map);
        });

        var marker = new google.maps.Marker({
          position: Latlng,
          map: map,
        });
        
        service_type = document.getElementById("service_type").value;

        var request = {
            location: mapInstance,
            radius: '150',
            type: [service_type]
        };
        service = new google.maps.places.PlacesService(map);
        service.nearbySearch(request, callback);

      }
      function callback(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            var place = results[i];
            createMarker(place);
          }
        }
      }
      function createMarker(place) {
        marks = new google.maps.Marker({
          position: place.geometry.location,
          map: map,
          title: place.name,
          icon: { url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png" }
        });

        google.maps.event.addListener(marks,'click',function(e) {
            infowindow.setContent(marks.getTitle());
            infowindow.open(map,marks);
        });
      }
      initMap();

    });
    
      request.error(function(response) {
        // failed
        console.log('err');
      });
    };

      // var service_type = document.getElementById('service_type');
     

});



// app1 = angular.module('graphApp',[]);

// app1.controller('crimeController', function($scope, $http) {
//   $scope.width = 1000;
//   $scope.height = 500;
//   $scope.yAxis = "Price per sqr ft";
//   $scope.xAxis = "Crime per 100000";
//   // normal variables
//   // Angular function
//   $scope.getCrimePrice = function() {

//     var request = $http({
//       url:'/crime',
//       method: "GET"
//     })

//     request.success(function(response) {
//       console.log(response);
//       console.log("get here !!!!!!!!")
//       $scope.rawDataPoints = response;
//     });

//     request.error(function(err) {
//       console.log("error: ", err);
//     });

//   };
//   $scope.getCrimePrice();

//   $scope.max_crime = 1500;
//   $scope.max_price = 1100;

// });
app.controller('crimeController', function($scope, $http) {
  $scope.width = 1000;
  $scope.height = 500;
  $scope.yAxis = "Price per sqr ft";
  $scope.xAxis = "Crime per 100000";
  // normal variables
  // Angular function
  $scope.getCrimePrice = function() {

    var request = $http({
      url:'/crime',
      method: "GET"
    })

    request.success(function(response) {
      console.log(response);
     
      $scope.rawDataPoints = response;
    });

    request.error(function(err) {
      console.log("error: ", err);
    });

  };
  $scope.getCrimePrice();
  $scope.parseInt = parseInt;

  $scope.max_crime = 1500;
  $scope.max_price = 1100;


  $scope.getState = function(){
    var selections = document.getElementById('selected_crime');
    var state = document.getElementById("selected_crime").value;
    console.log(selections);
    console.log(state);
    
    var request = $http.get('/visState/' + state); 

    // var request = $http.get('/userPreference')
  request.success(function(response) {
    // success
    $scope.selectedState = response;
     console.log("get here !!!!!!!!")
    // console.log("$scope.userInfo",$scope.userInfo);
  });
  
  request.error(function(response) {
    // failed
    console.log('err');
  });
};

});

app.controller('cityImageController', function($scope, $http) {    
  $scope.getImage = function(){
    var selections = document.getElementById('selected_state');
    var city = document.getElementById("inputCity").value;
    var state = selections.options[selections.selectedIndex].text;
    
    var request = $http.get('/cityImg/' + state + '/' + city); 

    // var request = $http.get('/userPreference')
  request.success(function(response) {
    // success
    $scope.statesInfo = response;
    // console.log("$scope.userInfo",$scope.userInfo);
  });
  
  request.error(function(response) {
    // failed
    console.log('err');
  });

  //code from the microsoft tutorial
    // Cookie names for data being stored
API_KEY_COOKIE   = "14e08e1900ee442b967f50df0c1c875e"; //bing-search-api-key
CLIENT_ID_COOKIE = "shuairui"; //bing-search-client-id
// The Bing Image Search API endpoint
BING_ENDPOINT = "https://api.cognitive.microsoft.com/bing/v7.0/images/search";

try { //Try to use localStorage first
    localStorage.getItem;   

    window.retrieveValue = function (name) {
        return localStorage.getItem(name) || "";
    }
    window.storeValue = function(name, value) {
        localStorage.setItem(name, value);
    }
} catch (e) {
    //If the browser doesn't support localStorage, try a cookie
    window.retrieveValue = function (name) {
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
            var keyvalue = cookies[i].split("=");
            if (keyvalue[0].trim() === name) return keyvalue[1];
        }
        return "";
    }
    window.storeValue = function (name, value) {
        var expiry = new Date();
        expiry.setFullYear(expiry.getFullYear() + 1);
        document.cookie = name + "=" + value.trim() + "; expires=" + expiry.toUTCString();
    }
}

// Get the stored API subscription key, or prompt if it's not found
$scope.getSubscriptionKey = function() {
  var key = retrieveValue(API_KEY_COOKIE);
  while (key.length !== 32) {
      key = prompt("Enter Bing Search API subscription key:", "").trim();
  }
  // always set the cookie in order to update the expiration date
  storeValue(API_KEY_COOKIE, key);
  return key;
}

  };
});